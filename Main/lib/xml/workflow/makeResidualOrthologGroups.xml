<workflowGraph name="makeResidualOrthologGroups">
  <param name="parentDataDir"/>
  <param name="residualFastaFile"/>
  <param name="inputTaxaDir"/>
  <param name="makeResidualGroupsDir"/>
  <param name="outputGroupsDir"/>
  <param name="suffix"/>
  <param name="useExistingSimSeqs"/>
  <param name="collapseClades"/>  
  <param name="includeSingletonGroups"/>  
  <param name="groupIdPrefix"/>  
  <param name="groupIdStart"/>  

  <!-- make a data dir  -->
  <step name="makeResidualGroupsDir" stepClass="ReFlow::StepClasses::MakeDataDir">
    <paramValue name="dataDir">$$makeResidualGroupsDir$$</paramValue>
  </step>

  <step name="makeResidualResultsDir" stepClass="ReFlow::StepClasses::MakeDataDir">
    <paramValue name="dataDir">$$makeResidualGroupsDir$$/master/</paramValue>
    <depends name="makeResidualGroupsDir"/>
  </step>

  <step name="makeOrthoFinderResidualNextflowConfig" stepClass="OrthoMCLWorkflow::Main::WorkflowSteps::MakeOrthoFinderResidualNextflowConfig">
    <paramValue name="clusterResultDir">$$makeResidualGroupsDir$$/master/mainresult/</paramValue>
    <paramValue name="configFileName">nextflow.config</paramValue>
    <paramValue name="analysisDir">$$makeResidualGroupsDir$$</paramValue>
    <paramValue name="inputFile">$$residualFastaFile$$</paramValue>
    <paramValue name="pValCutoff">1e-5</paramValue>
    <paramValue name="lengthCutoff">1</paramValue>
    <paramValue name="percentCutoff">1</paramValue>
    <paramValue name="adjustMatchLength">true</paramValue>
    <paramValue name="blastArgs">--dbsize 824802617</paramValue>
    <depends name="makeResidualResultsDir"/>
  </step>

  <step name="mirrorToCluster" stepClass="ReFlow::StepClasses::MirrorToComputeCluster" stepLoadTypes="toCluster">
    <paramValue name="fileOrDirToMirror">$$makeResidualGroupsDir$$</paramValue>
    <depends name="makeOrthoFinderResidualNextflowConfig"/>
  </step>

  <step name="runOrthoFinderResidualClusterTask" stepClass="ReFlow::StepClasses::RunAndMonitorNextflowWithEntry">
    <paramValue name="workingDir">$$makeResidualGroupsDir$$</paramValue>
    <paramValue name="resultsDir">$$makeResidualGroupsDir$$/master/mainresult</paramValue>
    <paramValue name="nextflowConfigFile">$$makeResidualGroupsDir$$/nextflow.config</paramValue>
    <paramValue name="nextflowWorkflow">VEuPathDB/orthofinder</paramValue>
    <paramValue name="isGitRepo">true</paramValue>
    <paramValue name="entry">residual</paramValue>
    <depends name="mirrorToCluster"/>
  </step>

  <step name="mirrorFromCluster" stepClass="ReFlow::StepClasses::MirrorFromComputeCluster">
    <paramValue name="fileOrDirToMirror">$$makeResidualGroupsDir$$/master/mainresult</paramValue>
    <paramValue name="outputDir">$$makeResidualGroupsDir$$/master/mainresult</paramValue>
    <paramValue name="outputFiles"></paramValue>
    <paramValue name="deleteAfterCopy">false</paramValue>
    <depends name="runOrthoFinderResidualClusterTask"/>
  </step>

  <!-- create tables (SimilarSequences, Ortholog, CoOrtholog, InParalog) -->
  <!-- create config file  -->
<!--
  <step name="installSchema" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InstallOrthomclSchema">
    <paramValue name="configFile">$$makeResidualGroupsDir$$/orthomclPairs.config</paramValue>
    <paramValue name="suffix">$$suffix$$</paramValue>
    <depends name="mirrorFromCluster"/>
  </step>
-->
  <!-- load BLAST results into SimilarSequences table -->
<!--
  <step name="loadBlast" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::LoadBlastWithSqlldr" excludeIf="$$useExistingSimSeqs$$">
    <paramValue name="inputFile">$$makeResidualGroupsDir$$/master/mainresult/diamondSimilarity.out</paramValue>
    <paramValue name="suffix">$$suffix$$</paramValue>
    <paramValue name="dataDir">$$makeResidualGroupsDir$$</paramValue>
    <depends name="installSchema"/>
  </step>
-->
<!--
  <step name="importBlast" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::ImportOrthomclTestData" includeIf="$$useExistingSimSeqs$$">
     <paramValue name="taxaDir">$$inputTaxaDir$$</paramValue>
     <paramValue name="suffix">$$suffix$$</paramValue>
     <paramValue name="collapseClades">$$collapseClades$$</paramValue>
     <paramValue name="inputProteinFile">$$makeResidualGroupsDir$$/proteomeDatasets/peripheralGood.fasta</paramValue>
     <depends name="loadBlast"/>
  </step>
-->
</workflowGraph>
