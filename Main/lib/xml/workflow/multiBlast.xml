<workflowGraph name="blastWorkflow">
    <param name="parentDataDir"/>
    <param name="nickName"/>
    <param name="blastArgs"/>
    <param name="fastaDirTarFile"/>
    <param name="coreDatabaseFasta"/> <!-- used to set -z value -->
    <param name="idRegex"/>
    <param name="blastType"/>
    <param name="vendor"/>
    <param name="maxMemoryGigs"/>
    <param name="makeSimSeqsFile"/>
    <constant name="dataDir">$$parentDataDir$$/$$nickName$$</constant>

    <step name="mirrorGroupFastasToCluster" stepClass="ReFlow::StepClasses::MirrorToComputeCluster">
      <paramValue name="fileOrDirToMirror">$$parentDataDir$$</paramValue>
    </step>

    <step name="makeDataDir" stepClass="ReFlow::StepClasses::MakeDataDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
      <depends name="mirrorGroupFastasToCluster"/>
    </step>

    <step name="makeMultiBlastNextflowConfig" stepClass="OrthoMCLWorkflow::Main::WorkflowSteps::MakeMultiSelfBlastSimilarityNextflowConfig">
      <paramValue name="clusterResultDir">$$dataDir$$/mainresult/</paramValue>
      <paramValue name="configFileName">nextflow.config</paramValue>
      <paramValue name="analysisDir">$$dataDir$$</paramValue>
      <paramValue name="tarFile">$$fastaDirTarFile$$</paramValue>
      <paramValue name="blastProgram">$$blastType$$</paramValue>
      <paramValue name="dataFile">blastSimilarity.out</paramValue>
      <paramValue name="logFile">blastSimilarity.log</paramValue>
      <paramValue name="printSimSeqs">$$makeSimSeqsFile$$</paramValue>
      <paramValue name="blastArgs">--dbsize 824802617</paramValue>      
      <depends name="makeDataDir"/>
    </step>

    <step name="mirrorToCluster" stepClass="ReFlow::StepClasses::MirrorToComputeCluster" stepLoadTypes="toCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$</paramValue>
      <depends name="makeMultiBlastNextflowConfig"/>
    </step>

    <step name="runMultiSelfBlastClusterTask" stepClass="ReFlow::StepClasses::RunAndMonitorNextflow">
      <paramValue name="workingDir">$$dataDir$$</paramValue>
      <paramValue name="resultsDir">$$dataDir$$/mainresult</paramValue>
      <paramValue name="nextflowConfigFile">$$dataDir$$/nextflow.config</paramValue>
      <paramValue name="nextflowWorkflow">VEuPathDB/multiSelfBlastSimilarity</paramValue>
      <paramValue name="isGitRepo">true</paramValue>
      <depends name="mirrorToCluster"/>
    </step>

    <step name="mirrorFromCluster" stepClass="ReFlow::StepClasses::MirrorFromComputeCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$/mainresult</paramValue>
      <paramValue name="outputDir">$$dataDir$$/master/mainresult</paramValue>
      <paramValue name="outputFiles">blastSimilarity.out</paramValue>
      <paramValue name="deleteAfterCopy">false</paramValue>
      <depends name="runMultiSelfBlastClusterTask"/>
    </step>

</workflowGraph>
